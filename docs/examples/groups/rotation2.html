<!DOCTYPE html>
<html>
<head>
  <title>Group Rotation Test</title>
</head>
<body>
  <canvas id="game" width="480" height="400"></canvas>
  <script src="../../../dist/chs.iife.js"></script>
  <script id="code">
  // Constants for main ghost body
var HEAD_RADIUS = 35;
var BODY_WIDTH = HEAD_RADIUS * 2;
var BODY_HEIGHT = 60;
var NUM_FEET = 3;
var FOOT_RADIUS = (BODY_WIDTH) / (NUM_FEET * 2); 

// Constants for eyes
var PUPIL_RADIUS = 4;
var PUPIL_LEFT_OFFSET = 8;
var PUPIL_RIGHT_OFFSET = 20;
var EYE_RADIUS = 10;
var EYE_OFFSET = 14;
let ghosts = [];

for (let i = 0; i < 20; i++) {
  newGhost();
}

const rotateGhosts = () => {
  ghosts.forEach(g => {
    g.rotate(g.rotRate);
  });
}

/* This is the callback drawing function. All we do here
 * is make a call to our drawGhost function with a random
 * position and random color. */
function newGhost(x, y, r){
	const ghostParts = drawGhost(
    x || Randomizer.nextInt(0, getWidth()),
	  y || Randomizer.nextInt(0, getHeight()),
		Randomizer.nextColor()
  );
  
  const g = new Group(...ghostParts);
  g.setOpacity(0.5);
  //g.__debugAABB = true;
  add(g);
  g.rotRate = r || (Math.random() < 0.5 ? 1 : -1) * Math.random() * 10;
  ghosts.push(g);
}

setTimer(rotateGhosts, 50);

/* This is a general draw circle function, which accepts any
 * radius, color, and x, y position. */
function drawCircle(radius, color, x, y){
	var circle = new Circle(radius);
	circle.setColor(color);
	circle.setPosition(x, y);
	return circle;
}

/* This is a general draw rectangle function, which takes as
 * parameters the width, height, color, and (x,y) location of
 * the top left corner of the rectangle. */
function drawRect(width, height, color, x, y){
	var rect = new Rectangle(width, height);
	rect.setColor(color);
	rect.setPosition(x, y);
  return rect;
}

/* This function draws a ghost whose head is centered at position
 * (cx, cy) and whose body is determined by the color parameter.
 */
function drawGhost(cx, cy, color){
  const parts = [];
	parts.push(drawCircle(HEAD_RADIUS, color, cx, cy));
	parts.push(drawRect(BODY_WIDTH, BODY_HEIGHT, 
			 color, cx - BODY_WIDTH / 2, cy));
		
	// This is a bit more confusing since it
	// draws a ghost with any number of feet
	for(var i = 0; i < NUM_FEET; i++){
		var start = -NUM_FEET + 1 + (i*2);
		parts.push(drawCircle(FOOT_RADIUS, color, 
				   cx + start*FOOT_RADIUS, 
				   cy + BODY_HEIGHT));
	}
  const leftEyeGroup = new Group();
  leftEyeGroup.add(drawCircle(EYE_RADIUS, Color.white, 
			   cx - EYE_OFFSET, cy));
  leftEyeGroup.add(drawCircle(PUPIL_RADIUS, Color.blue, 
			   cx - PUPIL_LEFT_OFFSET, cy))
  const rightEyeGroup = new Group();
  rightEyeGroup.add(drawCircle(EYE_RADIUS, Color.white, 
			   cx + EYE_OFFSET, cy));
  rightEyeGroup.add(drawCircle(PUPIL_RADIUS, Color.blue, 
			   cx + PUPIL_RIGHT_OFFSET, cy))
  parts.push(leftEyeGroup);
  parts.push(rightEyeGroup);
  setTimer(() => {
    leftEyeGroup.rotate(3)
    rightEyeGroup.rotate(3)
  }, 50)
  return parts;
}

  </script>
</body>
</html>